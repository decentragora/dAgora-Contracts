<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for factory/DagoraPaymentSplitterNFTFactory.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">factory/</a> DagoraPaymentSplitterNFTFactory.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/28</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/42</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/10</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/43</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: GPL-3.0
pragma solidity ^0.8.17;
&nbsp;
import {IDagoraMembershipsV1} from "../../contracts/interfaces/IDagoraMembershipsV1.sol";
import {ReentrancyGuardUpgradeable} from "@openzeppelin/contracts-upgradeable/security/ReentrancyGuardUpgradeable.sol";
import {OwnableUpgradeable} from '@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol';
import {Initializable} from "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import {Create2Upgradeable} from "@openzeppelin/contracts-upgradeable/utils/Create2Upgradeable.sol";
import {DagoraPaymentSplitterNFT} from "../wizards/dAgoraPaymentSplitterNFT.sol";
&nbsp;
&nbsp;
error DagoraFactory__TokenCreationPaused();
error DagoraFactory__InvalidTier(uint8 tier, uint8 neededTier);
error DagoraFactory__NotDAgoraMembershipsOwnerOrDelegate();
error DagoraFactory__ExpiredMembership();
&nbsp;
error DagoraFactory__FailedToCreateContract();
&nbsp;
contract DagoraPaymentSplitterFactory is Initializable, OwnableUpgradeable, ReentrancyGuardUpgradeable {
    
    struct NFTParams {
            string name;
            string symbol;
            address[] payees;
            uint256[] shares;
            uint256 mintPrice;
            uint256 maxSupply;
            uint16 bulkBuyLimit;
            string baseURI;
            string baseExtension;
            address newOwner;
    }
&nbsp;
    /// @notice Boolean to determine if the contract is paused.
    /// @dev default value is false, contract is not paused on deployment.
    bool public isPaused;
&nbsp;
    /// @notice The address of the dAgoraMemberships contract.
    address public dAgoraMembershipsAddress;
&nbsp;
    /// @notice The minimum tier required to create a NFTAPlus contract.
    uint8 public minTier;
&nbsp;
    /// @notice the count of all the contracts deployed by the factory
    uint256 public contractsDeployed;
&nbsp;
    event PaymentSplitterCreated(address newContractAddress, address ownerOf);
&nbsp;
    mapping(address =&gt; address[]) public userContracts;
&nbsp;
<span class="fstat-no" title="function not covered" >    function initialize(address _dAgoraMembershipsAddress) public initializer {</span>
<span class="cstat-no" title="statement not covered" >        __Ownable_init()</span>;
        dAgoraMembershipsAddress = _dAgoraMembershipsAddress;
        minTier = 1;
        isPaused = true;
    }
&nbsp;
&nbsp;
    /// @notice Modifier to check if the contract is paused.
    /// @dev Reverts if the contract is paused.
<span class="fstat-no" title="function not covered" >    modifier isNotPaused() {</span>
<span class="cstat-no" title="statement not covered" >        if (isPaused) {</span>
            revert DagoraFactory__TokenCreationPaused();
        }
        _;
    }
&nbsp;
    /// @notice Modifier to check if the user can create a contract.
    /// @dev Reverts if the user membership tier is not high enough, if the membership is expired, and if the user is not owner of tokenId.
    /// @param tokenId The id of the users membership tokenId.
    /// @param neededTier The tier required to create the Contract.
<span class="fstat-no" title="function not covered" >    modifier canCreate(uint256 tokenId, uint8 neededTier) {</span>
<span class="cstat-no" title="statement not covered" >        require(_canCreate(tokenId, neededTier), "dAgoraERC20Factory: Cannot create token")</span>;
        _;
    }
&nbsp;
&nbsp;
<span class="fstat-no" title="function not covered" >    function createNFT(</span>
        NFTParams memory params,
        uint256 id
    ) public isNotPaused canCreate(id, minTier) nonReentrant returns (address newImplementation) {
<span class="cstat-no" title="statement not covered" >        require(params.newOwner != address(0), "New owner cannot be 0 address")</span>;
<span class="cstat-no" title="statement not covered" >        require(params.newOwner != address(this), "New owner cannot be factory address")</span>;
<span class="cstat-no" title="statement not covered" >        require(params.maxSupply &gt; 0, "Max total supply cannot be 0")</span>;
<span class="cstat-no" title="statement not covered" >        require(params.bulkBuyLimit &gt; 0,  "Bulk buy limit amount cannot be 0")</span>;
<span class="cstat-no" title="statement not covered" >        require(params.bulkBuyLimit &lt; params.maxSupply, "Bulk buy limit cannot be greater than max total supply")</span>;
<span class="cstat-no" title="statement not covered" >        require(params.payees.length == params.shares.length, "Payees and shares arrays must be the same length")</span>;
<span class="cstat-no" title="statement not covered" >        require(paymentSharesTotal(params.shares) == 100, "Shares must add up to 100")</span>;
<span class="cstat-no" title="statement not covered" >        require(params.payees.length &gt; 0, "Payees array must be greater than 0")</span>;
<span class="cstat-no" title="statement not covered" >        require(params.shares.length &gt; 0, "Shares array must be greater than 0")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        bytes32 salt = keccak256(abi.encodePacked(params.name, msg.sender, block.timestamp));</span>
&nbsp;
        newImplementation = createNFTImpl(params, salt);
<span class="cstat-no" title="statement not covered" >        if (newImplementation == address(0)) {</span>
            revert DagoraFactory__FailedToCreateContract(); 
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        userContracts[msg.sender].push(newImplementation)</span>;
        contractsDeployed++;
<span class="cstat-no" title="statement not covered" >        emit PaymentSplitterCreated(newImplementation, msg.sender);</span>
    }
&nbsp;
    /// @notice Function that returns the deployed contracts by a user.
<span class="fstat-no" title="function not covered" >    function getUserContracts(address _user) external view returns(address[] memory) {</span>
<span class="cstat-no" title="statement not covered" >        return userContracts[_user];</span>
    }
&nbsp;
    /// @notice onlyOwner function to set the paused state of the contract.
<span class="fstat-no" title="function not covered" >    function togglePaused() external onlyOwner {</span>
        isPaused = !isPaused;
    }
        
    /// @notice onlyOwner function to set the minimum tier required to create a contract.
<span class="fstat-no" title="function not covered" >    function setMinTier(uint8 _minTier) external onlyOwner {</span>
        minTier = _minTier;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function paymentSharesTotal(uint256[] memory shares_) internal pure returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        uint256 totalShares;</span>
<span class="cstat-no" title="statement not covered" >        for (uint256 i = 0; i &lt; shares_.length; i++) {</span>
            totalShares += shares_[i];
        }
<span class="cstat-no" title="statement not covered" >        return totalShares;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function createNFTImpl(NFTParams memory params, bytes32 salt) internal returns (address) {</span>
<span class="cstat-no" title="statement not covered" >        bytes memory bytecode = abi.encodePacked(</span>
            type(DagoraPaymentSplitterNFT).creationCode,
            abi.encode(
                params.name,
                params.symbol,
                params.payees,
                params.shares,
                params.mintPrice,
                params.maxSupply,
                params.bulkBuyLimit,
                params.baseURI,
                params.baseExtension,
                params.newOwner
            )
        );
<span class="cstat-no" title="statement not covered" >        address newImplementation = Create2Upgradeable.deploy(0, salt, bytecode);</span>
<span class="cstat-no" title="statement not covered" >        return newImplementation;</span>
    }
&nbsp;
    /// @notice Internal function that checks if a address owns or is a delegate of a membership, and if the membership is valid, and if the membership tier is high enough.
    /// @param _id The id of the users membership tokenId.
    /// @param _neededTier The minimum membership tier required to create a contract.
    /// @return bool True or False. 
<span class="fstat-no" title="function not covered" >    function _canCreate(uint256 _id, uint8 _neededTier) internal view returns (bool) {</span>
<span class="cstat-no" title="statement not covered" >        if (IDagoraMembershipsV1(dAgoraMembershipsAddress).isOwnerOrDelegate(_id, msg.sender) != true) {</span>
           revert DagoraFactory__NotDAgoraMembershipsOwnerOrDelegate();
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint8 memberTier = IDagoraMembershipsV1(dAgoraMembershipsAddress).getMembershipTier(_id);</span>
<span class="cstat-no" title="statement not covered" >        if (memberTier &lt; _neededTier) {</span>
           revert DagoraFactory__InvalidTier(memberTier, _neededTier);
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (IDagoraMembershipsV1(dAgoraMembershipsAddress).isValidMembership(_id) != true) {</span>
           revert DagoraFactory__ExpiredMembership();
        } else {
<span class="cstat-no" title="statement not covered" >            return true;</span>
        }
    }    
&nbsp;
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu May 04 2023 18:55:37 GMT-0600 (Mountain Daylight Saving Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
